{% extends "base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_page.css') }}">

<div class="product-container">
    <!-- Галерея зображень -->
    <div class="product-gallery">
        {% if product.images %}
            <img id="main-image" src="{{ url_for('static', filename='images/' ~ product.images[0]) }}" alt="{{ product.name }}">
            <div class="thumbnail-container">
                {% for image in product.images %}
                    <img class="thumbnail" src="{{ url_for('static', filename='images/' ~ image) }}" alt="{{ product.name }}">
                {% endfor %}
            </div>
        {% else %}
            <img src="{{ url_for('static', filename='images/placeholder.jpg') }}" alt="Зображення відсутнє">
        {% endif %}
    </div>

    <!-- Інформація про товар -->
    <div class="product-info">
        <h1>{{ product.name }}</h1>
        <div class="price-section">
            <span class="price">{{ product.price }} грн</span>
        </div>


        <div class="attributes">
            <div class="colors">
                <span>Кольори:</span>
                {% for color in product.attributes.colors %}
                    <div class="color-box" style="background-color: {{ color }}"></div>
                {% endfor %}
            </div>

            <div class="sizes">
                <span>Розміри:</span>
                {% for size in product.attributes.sizes %}
                    <button class="size-button">{{ size }}</button>
                {% endfor %}
            </div>
        </div>

        <button class="add-to-cart">Додати в кошик</button>

        <!-- Акордіони -->
        <div class="accordions">
            {% if product.care %}
            <div class="accordion">
                <div class="accordion-header">
                    <span class="accordion-title">Догляд</span>
                    <span class="accordion-icon">ᐳ</span>
                </div>
                <div class="accordion-content">
                    <p>{{ product.care }}</p>
                </div>
            </div>
            {% endif %}

            <div class="accordion">
                <div class="accordion-header">
                    <span class="accordion-title">Опис</span>
                    <span class="accordion-icon">ᐳ</span>
                </div>
                <div class="accordion-content">
                    <p>{{ product.description }}</p>
                </div>
            </div>
        </div>


        <!-- Секція коментарів -->
<div class="comments-section">
    <h2>Відгуки ({{ comments|length }})</h2>

    <!-- Середня оцінка -->
    {% if average_rating %}
    <div class="average-rating">
        Середня оцінка: {{ average_rating|round(1) }} / 5
    </div>
    {% endif %}

    <!-- Форма додавання коментаря -->
    <form class="comment-form" method="POST" action="{{ url_for('add_comment', product_id=product.product_id) }}">
        <!-- Рейтинг -->
        <div class="rating-input">
            <span>Оцінка:</span>
            <div class="stars">
                {% for i in range(5, 0, -1) %}
                    <input
                        type="radio"
                        id="star{{ i }}"
                        name="rating"
                        value="{{ i }}"
                        required
                    >
                    <label for="star{{ i }}" class="star">★</label>
                {% endfor %}
            </div>
        </div>

        <!-- Коментар -->
        <label for="comment" class="visually-hidden">Ваш коментар</label>
        <textarea
            id="comment"
            name="comment"
            placeholder="Залишити коментар..."
            required
        ></textarea>

        <button type="submit">Відправити</button>
    </form>

    <!-- Список коментарів зі скролом -->
    <div class="comments-list">
        {% for comment in comments %}
        <div class="comment">
            <div class="comment-header">
                <span class="author">{{ comment.author }}</span>
                <span class="date">{{ comment.date }}</span>
            </div>
            <!-- Відображення рейтингу -->
            <div class="comment-rating">
                {% for _ in range(comment.rating) %}★{% endfor %}
            </div>
            <p class="text">{{ comment.text }}</p>
        </div>
        {% else %}
        <p>Ще немає відгуків. Будьте першим!</p>
        {% endfor %}
    </div>
</div>

<!-- Схожі товари -->
{% if related_products %}
    <div class="related-products">
        <h2>Рекомендовані товари</h2>
        <div class="products-grid">
            {% for product in related_products %}
                <!-- Додано посилання на сторінку товару -->
                <a
                    href="{{ url_for('product_page', product_id=product.product_id) }}"
                    class="product-card-link"
                >
                    <div class="product-card">
                        {% if product.images %}
                            <img
                                src="{{ url_for('static', filename='images/' ~ product.images[0]) }}"
                                alt="{{ product.name }}"
                            >
                        {% else %}
                            <img
                                src="{{ url_for('static', filename='images/placeholder.jpg') }}"
                                alt="Зображення відсутнє"
                            >
                        {% endif %}
                        <h3>{{ product.name }}</h3>
                        <p>{{ product.price }} грн</p>
                    </div>
                </a>
            {% endfor %}
        </div>
    </div>
{% endif %}
{% endblock %}
